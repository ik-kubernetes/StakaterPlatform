# Use this Makefile if you want to setup/deploy/destroy StakaterPlatform from devstation(local workstation;laptop, computer etc.)

.ONESHELL:
SHELL= /bin/bash

include variables.config

configure:
	git checkout $(STAKATER_PLATFORM_BRANCH) 2>/dev/null || git checkout -b $(STAKATER_PLATFORM_BRANCH) && \
	bash scripts/configure-dev.sh #&& \
	# TODO add pre-commit hook for skipping these files
	git update-index --skip-worktree variables.config
	git update-index --skip-worktree $(git ls-files | grep 'configs/' | cut -d/ -f2)
	git add . && \
	git commit -a -m "[skip ci] update vars for deployment"  && \
	git push -u origin $(STAKATER_PLATFORM_BRANCH) || true

deploy:
	bash scripts/install.sh $(CLOUD_PROVIDER)
	sleep 480
	bash scripts/verify.sh

verify:
	bash scripts/verify.sh

destroy:
	bash scripts/destroy.sh

.PHONY: configure deploy verify destroy